"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[7951],{5405:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"home/chains/midnight","title":"Midnight","description":"Midnight is a privacy-focused ZK (Zero-Knowledge) blockchain. Effectstream integrates with Midnight to read public state changes resulting from private circuit execution.","source":"@site/docs/home/200-chains/202-midnight.md","sourceDirName":"home/200-chains","slug":"/home/chains/midnight","permalink":"/docs/home/chains/midnight","draft":false,"unlisted":false,"editUrl":"https://github.com/PaimaStudios/paima-engine-docs/tree/main/docs/home/200-chains/202-midnight.md","tags":[],"version":"current","sidebarPosition":202,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"EVM-Compatible Chains","permalink":"/docs/home/chains/evm"},"next":{"title":"Cardano","permalink":"/docs/home/chains/cardano"}}');var r=t(2531),s=t(6613);const a={},o="Midnight",c={},d=[{value:"How Midnight Works: An Overview",id:"how-midnight-works-an-overview",level:3},{value:"Effectstream &amp; Midnight Integration",id:"effectstream--midnight-integration",level:3},{value:"1. Configuration (Read)",id:"1-configuration-read",level:2},{value:"Network Definition",id:"network-definition",level:3},{value:"Sync Protocol",id:"sync-protocol",level:3},{value:"Contract Development",id:"contract-development",level:3},{value:"Primitives",id:"primitives",level:3},{value:"2. Batcher Adapters (Write)",id:"2-batcher-adapters-write",level:2},{value:"Standard Midnight Adapter",id:"standard-midnight-adapter",level:3},{value:"3. Orchestration",id:"3-orchestration",level:2}];function l(e){const n={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"midnight",children:"Midnight"})}),"\n",(0,r.jsx)(n.p,{children:"Midnight is a privacy-focused ZK (Zero-Knowledge) blockchain. Effectstream integrates with Midnight to read public state changes resulting from private circuit execution."}),"\n",(0,r.jsx)(n.p,{children:"Some key points about Midnight:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Private State"}),": Keep user data and application logic confidential."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Confidential Transactions"}),": Execute transactions without revealing their details on-chain."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Verifiable Computation"}),": Run complex logic off-chain and prove its correct execution on-chain without revealing the inputs."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"how-midnight-works-an-overview",children:"How Midnight Works: An Overview"}),"\n",(0,r.jsx)(n.p,{children:"Midnight allows to keep the user's private and public data in the blockchain. The key components are, for understanding how it works:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User & Wallet"}),": Interacts with the dApp. The wallet manages keys and signs transactions, but sensitive data never leaves the user's device."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Proof Server"}),": A (local or remote) service that generates the ZK proofs required for transactions."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node"}),": The core blockchain client that validates transactions by verifying their ZK proofs and maintains the public ledger."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Indexer"}),": A service that tracks the public blockchain data, making it easily queryable for dApps."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Smart Contracts (Compact)"}),": Contracts are written in Compact, a language designed for ZK. They define private logic (circuits) and can expose a ",(0,r.jsxs)(n.strong,{children:["public ",(0,r.jsx)(n.code,{children:"ledger"})," state"]}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ledger"}),": The public state of the contract. It is the state that is exposed to the Effectstream."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"effectstream--midnight-integration",children:"Effectstream & Midnight Integration"}),"\n",(0,r.jsxs)(n.p,{children:["Effectstream acts as a powerful deterministic off-chain indexer and state machine that ",(0,r.jsx)(n.strong,{children:"monitors the public state"})," of Midnight contracts. It does not handle private data or proof generation. Instead, it observes the ",(0,r.jsx)(n.em,{children:"results"})," of private computations that are made public on the Midnight ledger."]}),"\n",(0,r.jsx)(n.p,{children:"This allows you to build complex dApps that combine the privacy of Midnight with the multi-chain data aggregation and deterministic logic of Effectstream."}),"\n",(0,r.jsx)(n.mermaid,{value:"graph TD\n    subgraph Effectstream\n        PaimaSync[Sync Service] --\x3e PaimaSM[State Machine]\n    end\n\n    subgraph User's Machine\n        A[User/Frontend] --\x3e B{Wallet};\n        B --\x3e C[Proof Server];\n    end\n\n    subgraph Midnight Network\n        D[Midnight Node] --\x3e E[Indexer];\n    end\n\n    C -- ZK Proof --\x3e B;\n    B -- Signed TX with Proof --\x3e D;\n    E -- Fetches Public State --\x3e PaimaSync;\n\n   "}),"\n",(0,r.jsx)(n.h2,{id:"1-configuration-read",children:"1. Configuration (Read)"}),"\n",(0,r.jsx)(n.h3,{id:"network-definition",children:"Network Definition"}),"\n",(0,r.jsx)(n.p,{children:"Define the connection to the Midnight node."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'.buildNetworks(builder =>\n  builder.addNetwork({\n    name: "midnight",\n    type: ConfigNetworkType.MIDNIGHT,\n    genesisHash: "0x...",\n    networkId: 0, // 0 for local undeployed/devnet\n    nodeUrl: "http://127.0.0.1:9944",\n  })\n)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"sync-protocol",children:"Sync Protocol"}),"\n",(0,r.jsxs)(n.p,{children:["The protocol type ",(0,r.jsx)(n.code,{children:"MIDNIGHT_PARALLEL"})," connects to the Midnight Indexer (GraphQL) to fetch state updates."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'.addParallel(\n  (networks) => networks.midnight,\n  (network, deployments) => ({\n    name: "parallelMidnight",\n    type: ConfigSyncProtocolType.MIDNIGHT_PARALLEL,\n    startBlockHeight: 1,\n    pollingInterval: 1000,\n    indexer: "http://127.0.0.1:8088/api/v1/graphql",\n    indexerWs: "ws://127.0.0.1:8088/api/v1/graphql/ws",\n  })\n)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"contract-development",children:"Contract Development"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Language"}),": Compact (a TypeScript-inspired DSL for ZK)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compilation"}),": ",(0,r.jsx)(n.code,{children:"deno task build:midnight"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["A Midnight contract defines private state transitions (",(0,r.jsx)(n.code,{children:"circuits"}),") and can choose to expose certain data publicly in its ",(0,r.jsx)(n.code,{children:"ledger"}),". Effectstream can only see what is in the public ",(0,r.jsx)(n.code,{children:"ledger"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Example (",(0,r.jsx)(n.code,{children:"main.rs"}),"):"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:"pragma language_version 0.16;\n\nimport CompactStandardLibrary;\n\n// This is the public state that Effectstream's primitive will monitor.\nexport ledger round: Counter;\n\n// This is a private state transition. When executed, it generates a ZK proof.\n// Its effect is made visible to Paima by the change it causes to the public `round` state.\nexport circuit increment(): [] {\n  round.increment(1);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"primitives",children:"Primitives"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"PrimitiveTypeMidnightGeneric"})}),": Monitors the public ",(0,r.jsx)(n.code,{children:"ledger"})," export of a Compact contract. Whenever a circuit modifies this public state, the primitive triggers."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import { PrimitiveTypeMidnightGeneric } from "@effectstream/sm/builtin";\nimport * as MyContract from "@my-project/midnight-contract/contract";\n\n.addPrimitive(\n  (syncProtocols) => syncProtocols.parallelMidnight,\n  (network, deployments, syncProtocol) => ({\n    name: "MidnightGameState",\n    type: PrimitiveTypeMidnightGeneric,\n    contractAddress: "...",\n    contract: { ledger: MyContract.ledger }, // The ledger definition from Compact compilation\n    stateMachinePrefix: "midnight-state-change",\n  })\n)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"2-batcher-adapters-write",children:"2. Batcher Adapters (Write)"}),"\n",(0,r.jsxs)(n.p,{children:["Writing to Midnight involves proving and submitting ZK circuits. Effectstream provides the ",(0,r.jsx)(n.code,{children:"MidnightAdapter"})," to handle this complexity."]}),"\n",(0,r.jsx)(n.h3,{id:"standard-midnight-adapter",children:"Standard Midnight Adapter"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"MidnightAdapter"})," manages the ZK proof generation (via a proof server) and transaction submission."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import { MidnightAdapter } from "@effectstream/batcher";\n\nconst midnightAdapter = new MidnightAdapter(\n  contractAddress,\n  walletSeed,\n  {\n    indexer: "...",\n    node: "...",\n    proofServer: "http://localhost:6300",\n    zkConfigPath: "path/to/zk/config",\n    privateStateStoreName: "my-app-store",\n  },\n  new MyContract.Contract(witnesses),\n  witnesses,\n  contractInfo,\n  NetworkId.Undeployed,\n  "parallelMidnight"\n);\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The adapter uses ",(0,r.jsx)(n.code,{children:"MidnightBatchBuilderLogic"})," to format inputs into circuit arguments compatible with the Compact runtime."]}),"\n",(0,r.jsx)(n.h2,{id:"3-orchestration",children:"3. Orchestration"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"launchMidnight"})," from ",(0,r.jsx)(n.code,{children:"@effectstream/orchestrator/start-midnight"})," to launch the full stack:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Midnight Node"}),"\n",(0,r.jsx)(n.li,{children:"GraphQL Indexer"}),"\n",(0,r.jsx)(n.li,{children:"Proof Server"}),"\n",(0,r.jsx)(n.li,{children:"Contract Deployment"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'// in start.ts\nprocessesToLaunch: [\n  ...launchMidnight("@my-project/midnight-contracts"),\n]\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["NOTE: To use this launcher you need to implement some ",(0,r.jsx)(n.code,{children:"deno task"})," in your project. A working implementation is provided in the ",(0,r.jsx)(n.code,{children:"template generator"}),", ",(0,r.jsx)(n.code,{children:"templates"})," or ",(0,r.jsx)(n.code,{children:"e2e tests"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "name": "@e2e/midnight-contracts",\n  ...\n  "tasks": {\n    "midnight-node:start": "CFG_PRESET=dev deno run -A --unstable-detect-cjs @effectstream/npm-midnight-node --dev --rpc-port 9944 --state-pruning archive --blocks-pruning archive --public-addr /ip4/127.0.0.1 --unsafe-rpc-external",\n    "midnight-node:wait": "wait-on tcp:9944",\n    "midnight-indexer:start": "RUST_BACKTRACE=1 LEDGER_NETWORK_ID=\\"Undeployed\\" SUBSTRATE_NODE_WS_URL=\\"ws://localhost:9944\\" APP__INFRA__SECRET=$(openssl rand -hex 32 | tr \'a-f\' \'A-F\') FEATURES_WALLET_ENABLED=\\"true\\" APP__INFRA__NODE__URL=\\"ws://localhost:9944\\" deno run -A --unstable-detect-cjs @effectstream/npm-midnight-indexer --binary --clean",\n    "midnight-indexer:wait": "wait-on tcp:8088",\n    "midnight-proof-server:start": "LEDGER_NETWORK_ID=\\"Undeployed\\" RUST_BACKTRACE=full SUBSTRATE_NODE_WS_URL=\\"ws://localhost:9944\\" deno run -A --unstable-detect-cjs @effectstream/npm-midnight-proof-server",\n    "midnight-proof-server:wait": "wait-on tcp:6300",\n    "midnight-contract:clean": "rm -rf midnight-level-db contract-eip-20.json contract-counter.json",\n    "midnight-contract:deploy": "deno task midnight-contract:clean && deno task contract-eip20:deploy && deno task contract-counter:deploy",\n    "contract-counter:deploy": "deno --unstable-detect-cjs -A contract-counter-deploy.ts",\n    "contract-eip20:deploy": "deno --unstable-detect-cjs -A contract-eip-20-deploy.ts"\n  }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},6613:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var i=t(1491);const r={},s=i.createContext(r);function a(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);