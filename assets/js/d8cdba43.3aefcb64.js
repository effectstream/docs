"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[8522],{6613:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(1491);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}},7852:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"home/components/api","title":"API","description":"The Effectstream Node runs a powerful, built-in HTTP server that exposes a RESTful API. This API is the primary way for your Frontend (dApp) and other external services to read the real-time, aggregated state of your application.","source":"@site/docs/home/100-components/103-api.md","sourceDirName":"home/100-components","slug":"/home/components/api","permalink":"/docs/home/components/api","draft":false,"unlisted":false,"editUrl":"https://github.com/PaimaStudios/paima-engine-docs/tree/main/docs/home/100-components/103-api.md","tags":[],"version":"current","sidebarPosition":103,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"State Machine","permalink":"/docs/home/components/state-machine"},"next":{"title":"Paima L2 Contract","permalink":"/docs/home/components/l2-contract"}}');var i=n(2531),r=n(6613);const a={},o="API",l={},d=[{value:"Built-in API Endpoints",id:"built-in-api-endpoints",level:2},{value:"Creating Custom API Endpoints",id:"creating-custom-api-endpoints",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"api",children:"API"})}),"\n",(0,i.jsxs)(t.p,{children:["The Effectstream Node runs a powerful, built-in HTTP server that exposes a RESTful API. This API is the primary way for your ",(0,i.jsx)(t.a,{href:"/docs/home/components/frontend",children:"Frontend (dApp)"})," and other external services to read the real-time, aggregated state of your application."]}),"\n",(0,i.jsxs)(t.p,{children:["You can explore the API interactively via the OpenAPI (Swagger) interface, typically available at ",(0,i.jsx)(t.code,{children:"http://localhost:PORT/documentation"})," in your local development environment."]}),"\n",(0,i.jsx)(t.h2,{id:"built-in-api-endpoints",children:"Built-in API Endpoints"}),"\n",(0,i.jsx)(t.p,{children:"Your Effectstream node comes with a set of default endpoints to query system status and generic data structures."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Path"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"/health"})}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["A simple health check to see if the node is running. Returns ",(0,i.jsx)(t.code,{children:'{"status": "ok"}'}),"."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"/block-heights"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Shows the current sync progress for all connected chains."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"/addresses"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Returns a paginated list of all wallets and their associated Paima accounts."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"/scheduled-data"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Shows a paginated list of all pending scheduled inputs (timers/ticks)."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"/tables/:tableName"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"A powerful generic endpoint to query any public table in your database. It supports automatic keyset pagination for high performance."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"/primitives/:primitiveName"})}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["Similar to ",(0,i.jsx)(t.code,{children:"/tables"}),", but specifically for querying the data aggregated by a primitive (e.g., all ERC721 token owners)."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"/rpc/evm"})}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["A partial implementation of the Ethereum JSON-RPC specification, allowing you to use standard EVM tools like ",(0,i.jsx)(t.code,{children:"viem"})," to query the Paima L2 state."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"/grammar"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Returns the JSON representation of the grammar your state machine is using."})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"creating-custom-api-endpoints",children:"Creating Custom API Endpoints"}),"\n",(0,i.jsxs)(t.p,{children:["While the built-in endpoints are useful, you will often need to create custom routes that expose specific, aggregated data tailored to your application's needs. Effectstream makes this easy by allowing you to define a custom ",(0,i.jsx)(t.code,{children:"apiRouter"})," function."]}),"\n",(0,i.jsxs)(t.p,{children:["This function is passed a ",(0,i.jsx)(t.code,{children:"fastify"})," server instance, allowing you to register your own GET, POST, or other routes."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsxs)(t.strong,{children:["Example (",(0,i.jsx)(t.code,{children:"api.ts"}),"):"]})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",children:'import { type Static, Type } from "@sinclair/typebox";\nimport { runPreparedQuery } from "@effectstream/db";\nimport { getMyCustomGameData } from "@example-evm-midnight/database"; // Your custom pgtyped query\nimport type { Pool } from "pg";\nimport type { StartConfigApiRouter } from "@effectstream/runtime";\nimport type fastify from "fastify";\n\n// Define the schema for the API response using TypeBox.\n// This provides automatic validation and generates OpenAPI documentation.\nconst ResponseSchema = Type.Array(Type.Object({\n  token_id: Type.String(),\n  owner: Type.Union([Type.Null(), Type.String()]),\n  property_name: Type.String(),\n  value: Type.String(),\n}));\n\n/**\n * Register your custom API endpoints here.\n * @param server - The Fastify instance provided by the Paima runtime.\n * @param dbConn - A database connection pool.\n */\nexport const apiRouter: StartConfigApiRouter = async function (\n  server: fastify.FastifyInstance,\n  dbConn: Pool,\n): Promise<void> {\n  server.get<{\n    Reply: Static<typeof ResponseSchema>;\n  }>("/api/my-game/get-characters", async (request, reply) => {\n    // Execute a pre-defined, type-safe database query\n    const result = await runPreparedQuery(\n      getMyCustomGameData.run(undefined, dbConn),\n      "/api/my-game/get-characters",\n    );\n    reply.send(result);\n  });\n};\n'})}),"\n",(0,i.jsx)(t.p,{children:"By defining custom endpoints, you can create an efficient, tailored API that provides your frontend with exactly the data it needs, in the format it expects, without exposing the raw database structure."}),"\n",(0,i.jsxs)(t.p,{children:["To define and read the database queries see the ",(0,i.jsx)(t.a,{href:"/docs/home/components/database",children:"database section"})]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);