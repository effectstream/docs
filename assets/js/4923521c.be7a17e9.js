"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[2022],{6613:(e,i,n)=>{n.d(i,{R:()=>a,x:()=>c});var t=n(1491);const r={},s=t.createContext(r);function a(e){const i=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:i},e.children)}},7607:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"home/components/batcher/batching-pipeline","title":"The Batching Pipeline","description":"Overview","source":"@site/docs/home/100-components/108-batcher/1230-batching-pipeline.md","sourceDirName":"home/100-components/108-batcher","slug":"/home/components/batcher/batching-pipeline","permalink":"/paima-v-next-docs/home/components/batcher/batching-pipeline","draft":false,"unlisted":false,"editUrl":"https://github.com/PaimaStudios/paima-engine-docs/tree/main/docs/home/100-components/108-batcher/1230-batching-pipeline.md","tags":[],"version":"current","sidebarPosition":1230,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Core Concepts","permalink":"/paima-v-next-docs/home/components/batcher/core-concepts"},"next":{"title":"Configuration","permalink":"/paima-v-next-docs/home/components/batcher/configuration"}}');var r=n(2531),s=n(6613);const a={},c="The Batching Pipeline",l={},o=[{value:"Overview",id:"overview",level:2},{value:"Target Audience",id:"target-audience",level:2},{value:"The Input Lifecycle",id:"the-input-lifecycle",level:2},{value:"Step 1: Ingestion",id:"step-1-ingestion",level:3},{value:"Step 2: Targeting",id:"step-2-targeting",level:3},{value:"Step 3: Validation (Adapter-Driven)",id:"step-3-validation-adapter-driven",level:3},{value:"3a. Signature Verification",id:"3a-signature-verification",level:4},{value:"3b. Input Validation",id:"3b-input-validation",level:4},{value:"Step 4: Queuing",id:"step-4-queuing",level:3},{value:"Confirmation Level: &quot;no-wait&quot;",id:"confirmation-level-no-wait",level:4},{value:"Step 5: Polling &amp; Criteria Check",id:"step-5-polling--criteria-check",level:3},{value:"Batching Criteria Types",id:"batching-criteria-types",level:4},{value:"Step 6: Building (Adapter-Driven)",id:"step-6-building-adapter-driven",level:3},{value:"Step 7: Submission (Adapter-Driven)",id:"step-7-submission-adapter-driven",level:3},{value:"Step 8: Confirmation (Adapter-Driven)",id:"step-8-confirmation-adapter-driven",level:3},{value:"Confirmation Level: &quot;wait-receipt&quot;",id:"confirmation-level-wait-receipt",level:4},{value:"Step 9: Statestream Processing (Optional)",id:"step-9-statestream-processing-optional",level:3},{value:"Confirmation Level: &quot;wait-paima-processed&quot;",id:"confirmation-level-wait-paima-processed",level:4},{value:"Step 10: Callback Resolution",id:"step-10-callback-resolution",level:3},{value:"Confirmation Level Fallback Logic",id:"confirmation-level-fallback-logic",level:2},{value:"Pipeline Visualization",id:"pipeline-visualization",level:2},{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"the-batching-pipeline",children:"The Batching Pipeline"})}),"\n",(0,r.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(i.p,{children:"Understanding how an input flows through the Batcher system is essential for effective integration and customization. This document provides a comprehensive, step-by-step overview of an input's lifecycle\u2014from the initial API call to final chain confirmation."}),"\n",(0,r.jsx)(i.p,{children:"This knowledge helps you:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Understand where adapter customization hooks in"}),"\n",(0,r.jsx)(i.li,{children:"Configure appropriate confirmation levels for your use case"}),"\n",(0,r.jsx)(i.li,{children:"Debug issues in the batching flow"}),"\n",(0,r.jsx)(i.li,{children:"Optimize batch submission timing"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"target-audience",children:"Target Audience"}),"\n",(0,r.jsx)(i.p,{children:"Developers building on or integrating with the Paima platform who need to batch transactions, especially those who want to:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Customize adapter behavior for different blockchains"}),"\n",(0,r.jsx)(i.li,{children:"Understand validation and security guarantees"}),"\n",(0,r.jsx)(i.li,{children:"Configure confirmation levels appropriately"}),"\n",(0,r.jsx)(i.li,{children:"Implement custom batching strategies"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"the-input-lifecycle",children:"The Input Lifecycle"}),"\n",(0,r.jsx)(i.p,{children:"Every input submitted to the Batcher goes through a well-defined pipeline. Here's the complete journey:"}),"\n",(0,r.jsx)(i.h3,{id:"step-1-ingestion",children:"Step 1: Ingestion"}),"\n",(0,r.jsxs)(i.p,{children:["An HTTP POST request is made to the ",(0,r.jsx)(i.code,{children:"/send-input"})," endpoint with a payload conforming to the ",(0,r.jsx)(i.code,{children:"DefaultBatcherInput"})," type:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-typescript",children:'{\n  "data": {\n    "address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",\n    "addressType": 0,  // EVM address type\n    "input": "myGameCommand|arg1|arg2",\n    "signature": "0x...",\n    "timestamp": "1234567890",\n    "target": "evm"  // Optional, uses defaultTarget if not specified\n  },\n  "confirmationLevel": "wait-receipt"  // Optional\n}\n'})}),"\n",(0,r.jsx)(i.p,{children:"The API accepts the request and begins processing it through the pipeline."}),"\n",(0,r.jsx)(i.h3,{id:"step-2-targeting",children:"Step 2: Targeting"}),"\n",(0,r.jsxs)(i.p,{children:["The batcher examines the ",(0,r.jsx)(i.code,{children:"input.target"})," field to determine which blockchain adapter should handle this input. If ",(0,r.jsx)(i.code,{children:"target"})," is not provided, it falls back to the ",(0,r.jsx)(i.code,{children:"defaultTarget"})," specified in the ",(0,r.jsx)(i.code,{children:"PaimaBatcherConfig"}),"."]}),"\n",(0,r.jsx)(i.p,{children:"For example, if your configuration has:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-typescript",children:'{\n  adapters: { \n    evm: evmAdapter, \n    midnight: midnightAdapter \n  },\n  defaultTarget: "evm"\n}\n'})}),"\n",(0,r.jsxs)(i.p,{children:["Then an input without a ",(0,r.jsx)(i.code,{children:"target"})," field will be routed to the ",(0,r.jsx)(i.code,{children:"evmAdapter"}),"."]}),"\n",(0,r.jsx)(i.h3,{id:"step-3-validation-adapter-driven",children:"Step 3: Validation (Adapter-Driven)"}),"\n",(0,r.jsxs)(i.p,{children:["Once the target adapter is identified, the batcher performs two crucial validation steps ",(0,r.jsx)(i.strong,{children:"before"})," the input is queued:"]}),"\n",(0,r.jsx)(i.h4,{id:"3a-signature-verification",children:"3a. Signature Verification"}),"\n",(0,r.jsxs)(i.p,{children:["The batcher calls the adapter's ",(0,r.jsx)(i.code,{children:"verifySignature()"})," method. This is adapter-specific because different blockchains have different signature schemes:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"EVM adapters"}),": Use the default EVM signature verification (via ",(0,r.jsx)(i.code,{children:"CryptoManager.Evm().verifySignature()"}),")"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Custom adapters"}),": Can override this method to implement their own logic or bypass it entirely"]}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-typescript",children:"verifySignature(input: DefaultBatcherInput): boolean {\n  // Bypass the default EVM signature check\n  return true;\n}\n"})}),"\n",(0,r.jsxs)(i.p,{children:["If signature verification fails, the input is ",(0,r.jsx)(i.strong,{children:"rejected immediately"})," with a ",(0,r.jsx)(i.code,{children:"401 Unauthorized"})," error."]}),"\n",(0,r.jsx)(i.h4,{id:"3b-input-validation",children:"3b. Input Validation"}),"\n",(0,r.jsxs)(i.p,{children:["The adapter's ",(0,r.jsx)(i.code,{children:"validateInput()"})," method is called to perform semantic validation specific to that blockchain:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Check circuit argument formats (e.g., for zero-knowledge chains)"}),"\n",(0,r.jsx)(i.li,{children:"Validate payload structure"}),"\n",(0,r.jsx)(i.li,{children:"Verify account formats"}),"\n",(0,r.jsx)(i.li,{children:"Check any other chain-specific requirements"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-typescript",children:'// Example validation\nvalidateInput(input: DefaultBatcherInput): ValidationResult {\n  if (!isValidCircuitArgs(input.input)) {\n    return { \n      valid: false, \n      error: "Invalid circuit arguments format" \n    };\n  }\n  return { valid: true };\n}\n'})}),"\n",(0,r.jsxs)(i.p,{children:["If validation fails, the input is ",(0,r.jsx)(i.strong,{children:"rejected immediately"})," with a ",(0,r.jsx)(i.code,{children:"400 Bad Request"})," error containing the validation error message."]}),"\n",(0,r.jsx)(i.admonition,{title:"Why Validate Before Queuing?",type:"tip",children:(0,r.jsx)(i.p,{children:"Pre-queue validation ensures that only valid inputs reach persistent storage. This prevents storage pollution and makes the system more robust during restarts and crashes."})}),"\n",(0,r.jsx)(i.h3,{id:"step-4-queuing",children:"Step 4: Queuing"}),"\n",(0,r.jsxs)(i.p,{children:["After passing validation, the input is saved to the ",(0,r.jsx)(i.code,{children:"BatcherStorage"})," (e.g., ",(0,r.jsx)(i.code,{children:"FileStorage"}),", PostgreSQL, Redis)."]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Important"}),": Storage is the single source of truth. There are no in-memory queues that could be lost on restart."]}),"\n",(0,r.jsx)(i.h4,{id:"confirmation-level-no-wait",children:'Confirmation Level: "no-wait"'}),"\n",(0,r.jsxs)(i.p,{children:["If ",(0,r.jsx)(i.code,{children:"confirmationLevel"})," is set to ",(0,r.jsx)(i.code,{children:'"no-wait"'}),", the API call ",(0,r.jsx)(i.strong,{children:"returns immediately"})," at this point with a success response:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "success": true,\n  "message": "Input queued for batching",\n  "inputsProcessed": 1\n}\n'})}),"\n",(0,r.jsx)(i.p,{children:"The caller doesn't wait for the batch to be submitted or confirmed."}),"\n",(0,r.jsx)(i.h3,{id:"step-5-polling--criteria-check",children:"Step 5: Polling & Criteria Check"}),"\n",(0,r.jsxs)(i.p,{children:["The main ",(0,r.jsx)(i.code,{children:"PaimaBatcher"})," loop runs at intervals defined by ",(0,r.jsx)(i.code,{children:"pollingIntervalMs"})," (e.g., every 1000ms). On each iteration:"]}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:'For each adapter target (e.g., "evm", "midnight"), the batcher checks the batching criteria'}),"\n",(0,r.jsx)(i.li,{children:"The criteria determine if enough inputs have accumulated or enough time has passed"}),"\n",(0,r.jsx)(i.li,{children:"Different targets can have different criteria"}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"batching-criteria-types",children:"Batching Criteria Types"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Criteria Type"}),(0,r.jsx)(i.th,{children:"Description"}),(0,r.jsx)(i.th,{children:"Example"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"time"})}),(0,r.jsx)(i.td,{children:"Submit every N milliseconds"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'{ criteriaType: "time", timeWindowMs: 5000 }'})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"size"})}),(0,r.jsx)(i.td,{children:"Submit when N inputs accumulate"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'{ criteriaType: "size", maxBatchSize: 10 }'})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"value"})}),(0,r.jsx)(i.td,{children:"Submit when accumulated value reaches threshold"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'{ criteriaType: "value", targetValue: 100 }'})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"hybrid"})}),(0,r.jsx)(i.td,{children:"Submit when time OR size criteria met"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'{ criteriaType: "hybrid", timeWindowMs: 5000, maxBatchSize: 10 }'})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"custom"})}),(0,r.jsx)(i.td,{children:"Custom function determines readiness"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'{ criteriaType: "custom", isBatchReadyFn: (inputs) => {...} }'})})]})]})]}),"\n",(0,r.jsx)(i.p,{children:"Example configuration:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-typescript",children:'batchingCriteria: {\n  evm: { \n    criteriaType: "time", \n    timeWindowMs: 5000 \n  },\n  midnight: { \n    criteriaType: "hybrid", \n    timeWindowMs: 10000, \n    maxBatchSize: 20 \n  }\n}\n'})}),"\n",(0,r.jsx)(i.p,{children:"When the criteria for a target is satisfied, the batcher proceeds to build and submit the batch."}),"\n",(0,r.jsx)(i.h3,{id:"step-6-building-adapter-driven",children:"Step 6: Building (Adapter-Driven)"}),"\n",(0,r.jsx)(i.p,{children:"Once a target is ready for batching, the batcher:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Retrieves pending inputs for that target from storage"}),"\n",(0,r.jsxs)(i.li,{children:["Calls the adapter's ",(0,r.jsx)(i.code,{children:"buildBatchData()"})," method with these inputs"]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["The adapter's ",(0,r.jsx)(i.code,{children:"buildBatchData()"})," method is responsible for:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Serializing inputs into a blockchain-specific format"}),"\n",(0,r.jsxs)(i.li,{children:["Handling size constraints (respecting ",(0,r.jsx)(i.code,{children:"maxBatchSize"}),")"]}),"\n",(0,r.jsx)(i.li,{children:"Deciding which inputs to include or exclude"}),"\n",(0,r.jsx)(i.li,{children:"Returning the final batch payload"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-typescript",children:"interface BatchBuildingResult<TOutput> {\n  selectedInputs: DefaultBatcherInput[];  // Inputs included in this batch\n  data: TOutput;  // Serialized batch data (format depends on chain)\n}\n"})}),"\n",(0,r.jsx)(i.p,{children:"For example:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"EVM adapters"})," might serialize to a hex string"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Midnight adapters"})," might construct circuit arguments"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Custom adapters"})," can use any format their chain accepts"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"step-7-submission-adapter-driven",children:"Step 7: Submission (Adapter-Driven)"}),"\n",(0,r.jsxs)(i.p,{children:["The batcher calls the adapter's ",(0,r.jsx)(i.code,{children:"submitBatch()"})," method, passing:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"The serialized data from Step 6"}),"\n",(0,r.jsxs)(i.li,{children:["An estimated fee (obtained via ",(0,r.jsx)(i.code,{children:"estimateBatchFee()"}),")"]}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-typescript",children:"const fee = await adapter.estimateBatchFee(data);\nconst txHash = await adapter.submitBatch(data, fee);\n"})}),"\n",(0,r.jsx)(i.p,{children:"The adapter handles all blockchain-specific submission logic:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Constructing the transaction"}),"\n",(0,r.jsx)(i.li,{children:"Signing it with the configured private key"}),"\n",(0,r.jsx)(i.li,{children:"Submitting it to the RPC endpoint"}),"\n",(0,r.jsx)(i.li,{children:"Returning the transaction hash"}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["State transition event ",(0,r.jsx)(i.code,{children:"batch:submit"})," is emitted at this point."]}),"\n",(0,r.jsx)(i.h3,{id:"step-8-confirmation-adapter-driven",children:"Step 8: Confirmation (Adapter-Driven)"}),"\n",(0,r.jsxs)(i.p,{children:["After submission, the batcher calls ",(0,r.jsx)(i.code,{children:"adapter.waitForTransactionReceipt()"})," to wait for the transaction to be included in a block."]}),"\n",(0,r.jsx)(i.p,{children:"The adapter polls the blockchain until:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"The transaction is confirmed (successful receipt)"}),"\n",(0,r.jsx)(i.li,{children:"An error occurs"}),"\n",(0,r.jsx)(i.li,{children:"A timeout is reached"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"Once the receipt is obtained:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["The processed inputs are ",(0,r.jsx)(i.strong,{children:"removed from storage"})]}),"\n",(0,r.jsxs)(i.li,{children:["State transition event ",(0,r.jsx)(i.code,{children:"batch:receipt"})," is emitted"]}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"confirmation-level-wait-receipt",children:'Confirmation Level: "wait-receipt"'}),"\n",(0,r.jsxs)(i.p,{children:["If ",(0,r.jsx)(i.code,{children:"confirmationLevel"})," is ",(0,r.jsx)(i.code,{children:'"wait-receipt"'}),", the API call ",(0,r.jsx)(i.strong,{children:"returns at this point"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "success": true,\n  "message": "Input processed successfully",\n  "transactionHash": "0xabc...",\n  "inputsProcessed": 1\n}\n'})}),"\n",(0,r.jsx)(i.h3,{id:"step-9-statestream-processing-optional",children:"Step 9: Statestream Processing (Optional)"}),"\n",(0,r.jsx)(i.p,{children:"After blockchain confirmation, the batcher optionally waits for the Statestream to process the batch. This step:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Monitors Statestream Sync events for the specific transaction"}),"\n",(0,r.jsx)(i.li,{children:"Waits until the Statestream has parsed and validated the inputs"}),"\n",(0,r.jsx)(i.li,{children:"Returns the rollup block number where processing occurred"}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"confirmation-level-wait-paima-processed",children:'Confirmation Level: "wait-paima-processed"'}),"\n",(0,r.jsxs)(i.p,{children:["If ",(0,r.jsx)(i.code,{children:"confirmationLevel"})," is ",(0,r.jsx)(i.code,{children:'"wait-paima-processed"'}),", the API call ",(0,r.jsx)(i.strong,{children:"waits until this step completes"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "success": true,\n  "message": "Input processed and validated by Statestream",\n  "transactionHash": "0xabc...",\n  "rollup": 12345,\n  "inputsProcessed": 1\n}\n'})}),"\n",(0,r.jsxs)(i.p,{children:["This provides the strongest guarantee: the input has been confirmed on-chain ",(0,r.jsx)(i.strong,{children:"and"})," processed by your game/application logic."]}),"\n",(0,r.jsx)(i.h3,{id:"step-10-callback-resolution",children:"Step 10: Callback Resolution"}),"\n",(0,r.jsxs)(i.p,{children:["Finally, the original API caller receives the response based on their configured ",(0,r.jsx)(i.code,{children:"confirmationLevel"}),"."]}),"\n",(0,r.jsx)(i.p,{children:"All waiting callers whose inputs were included in this batch are resolved simultaneously."}),"\n",(0,r.jsx)(i.h2,{id:"confirmation-level-fallback-logic",children:"Confirmation Level Fallback Logic"}),"\n",(0,r.jsxs)(i.p,{children:["If ",(0,r.jsx)(i.code,{children:"confirmationLevel"})," is not explicitly provided in the API call, the batcher uses this fallback hierarchy:"]}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Target-specific configuration"}),": Check if ",(0,r.jsx)(i.code,{children:"PaimaBatcherConfig.confirmationLevel"})," is an object with a key matching the target:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-typescript",children:'confirmationLevel: { \n  evm: "no-wait", \n  midnight: "wait-receipt" \n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Global configuration"}),": If ",(0,r.jsx)(i.code,{children:"confirmationLevel"})," is a string, use it for all targets:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-typescript",children:'confirmationLevel: "wait-receipt"\n'})}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Default"}),": If nothing is configured, default to ",(0,r.jsx)(i.code,{children:'"wait-receipt"'})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"pipeline-visualization",children:"Pipeline Visualization"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1. HTTP POST /send-input                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  2. Target Selection (use input.target or defaultTarget)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  3. Validation (Adapter-Driven)                             \u2502\n\u2502     \u2022 verifySignature() - Check cryptographic signature     \u2502\n\u2502     \u2022 validateInput() - Semantic validation                 \u2502\n\u2502                                                              \u2502\n\u2502  \u274c Fails \u2192 400/401 error returned immediately              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  4. Save to BatcherStorage                                  \u2502\n\u2502                                                              \u2502\n\u2502  \ud83d\udd39 confirmationLevel: "no-wait" \u2192 API returns here         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  5. Polling Loop (every pollingIntervalMs)                  \u2502\n\u2502     Check batchingCriteria for each target                  \u2502\n\u2502     Ready? \u2192 Proceed to build                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  6. adapter.buildBatchData()                                \u2502\n\u2502     Serialize inputs \u2192 blockchain-specific format           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  7. adapter.submitBatch(data, fee)                          \u2502\n\u2502     Submit transaction to blockchain                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  8. adapter.waitForTransactionReceipt()                     \u2502\n\u2502     Wait for blockchain confirmation                        \u2502\n\u2502     Remove processed inputs from storage                    \u2502\n\u2502                                                              \u2502\n\u2502  \ud83d\udd39 confirmationLevel: "wait-receipt" \u2192 API returns here    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  9. Wait for Paima Processing (Optional)                    \u2502\n\u2502     Monitor Paima Sync events                               \u2502\n\u2502     Wait for rollup block processing                        \u2502\n\u2502                                                              \u2502\n\u2502  \ud83d\udd39 confirmationLevel: "wait-paima-processed" \u2192 returns here\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  10. Callback Resolution                                    \u2502\n\u2502      Return final response to API caller                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,r.jsx)(i.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Validation happens before queuing"}),": Invalid inputs never reach storage"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Storage is crash-safe"}),": Inputs persist through restarts"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Adapters control key operations"}),": Signature verification, validation, building, and submission are all adapter-specific"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Confirmation levels offer flexibility"}),": Choose between immediate return, blockchain confirmation, or full Paima processing"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Per-target configuration"}),": Different blockchain targets can have different criteria and confirmation levels"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Event-driven observability"}),": State transitions emit events throughout the pipeline for monitoring and logging"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Learn about ",(0,r.jsx)(i.a,{href:"/paima-v-next-docs/home/components/batcher/adapter",children:"Custom Adapters"})," to support new blockchains"]}),"\n",(0,r.jsxs)(i.li,{children:["Explore ",(0,r.jsx)(i.a,{href:"/paima-v-next-docs/home/components/batcher/advanced-topics#batching-criteria",children:"Batching Criteria"})," for advanced batch timing strategies"]}),"\n",(0,r.jsxs)(i.li,{children:["Review ",(0,r.jsx)(i.a,{href:"/paima-v-next-docs/home/components/batcher/configuration",children:"Configuration Reference"})," for all available options"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);