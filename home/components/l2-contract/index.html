<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-home/components/l2-contract" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Paima L2 Contract | Effectstream</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://effectstream.github.io/docs/img/no-image.png"><meta data-rh="true" name="twitter:image" content="https://effectstream.github.io/docs/img/no-image.png"><meta data-rh="true" property="og:url" content="https://effectstream.github.io/docs/home/components/l2-contract"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Paima L2 Contract | Effectstream"><meta data-rh="true" name="description" content="The PaimaL2Contract is a specialized, gas-efficient smart contract that serves as the primary &quot;mailbox&quot; or data entry point for your Effectstream application. While Paima can monitor any contract, the PaimaL2Contract is optimized for submitting user actions and game moves directly to your state machine."><meta data-rh="true" property="og:description" content="The PaimaL2Contract is a specialized, gas-efficient smart contract that serves as the primary &quot;mailbox&quot; or data entry point for your Effectstream application. While Paima can monitor any contract, the PaimaL2Contract is optimized for submitting user actions and game moves directly to your state machine."><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://effectstream.github.io/docs/home/components/l2-contract"><link data-rh="true" rel="alternate" href="https://effectstream.github.io/docs/home/components/l2-contract" hreflang="en"><link data-rh="true" rel="alternate" href="https://effectstream.github.io/docs/ja/home/components/l2-contract" hreflang="ja"><link data-rh="true" rel="alternate" href="https://effectstream.github.io/docs/home/components/l2-contract" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><link rel="stylesheet" href="/docs/assets/css/styles.fce0bafc.css">
<script src="/docs/assets/js/runtime~main.0ef004e6.js" defer="defer"></script>
<script src="/docs/assets/js/main.3f307b27.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/img/favicon.ico"><div role="region" aria-label="Skip to main content"><a class="skipToContent_LRwd" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_llC7" style="background-color:#fffcf9;color:#ef476f" role="banner"><div class="content_Pagn announcementBarContent_QHqT">
      <div class="custom-banner">
        <p><strong>You are looking at Effectstream v2 docs</strong></p>
        <p>Effectstream v2 is still under constructionðŸš§</p>
      </div>
    </div></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/docs/"><div class="navbar__logo"><img src="/docs/img/favicon.ico" alt="Effectstream logo" class="themedComponent_m_92 themedComponent--light_mRW5"><img src="/docs/img/favicon.ico" alt="Effectstream logo" class="themedComponent_m_92 themedComponent--dark_iQ27"></div><b class="navbar__title text--truncate">Effectstream</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_J6rI"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/home/components/l2-contract" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/docs/ja/home/components/l2-contract" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">Japanese</a></li></ul></div><div class="navbarSearchContainer_E3Re"><div class="navbar__search searchBarContainer_sERs" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_s8y1 searchBarLoadingRing_W2S3"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_Gcnp"><div class="docsWrapper_xhHm"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_P6dF" type="button"></button><div class="docRoot_QZFe"><aside class="theme-doc-sidebar-container docSidebarContainer_z8Xi"><div class="sidebarViewport_LtND"><div class="sidebar_eBd7"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_sQgX menuWithAnnouncementBar_IFIy"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/">Intro</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/what-is-effectstream">What is Effectstream?</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/home/components/">Components</a><button aria-label="Collapse sidebar category &#x27;Components&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/sync-service">Sync Protocols &amp; Chain Config</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/state-machine">State Machine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/api">API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/home/components/l2-contract">Paima L2 Contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/contracts">Contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/processes">Process Orchestrator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/explorer">Paima Explorer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/home/components/batcher/overview">Batcher</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/database">Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/logs">Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/grammar">Grammar</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/wallets">Wallets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/randomness">Randomness</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/achievements">Achievements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/frontend">Frontend (dApp)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/accounts">Accounts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/node-startup">Node Startup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/home/components/primitives">Primitives</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/home/chains/">Chains</a><button aria-label="Expand sidebar category &#x27;Chains&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/home/deployment/deploy-game">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/home/paima-standards/">Paima Standards (PRCs)</a><button aria-label="Expand sidebar category &#x27;Paima Standards (PRCs)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/home/effectstream-engine/">Architecture</a><button aria-label="Expand sidebar category &#x27;Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/home/templates/evm-midnight">Templates</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/PaimaStudios/paima-game-templates" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_TdTm">Paima Game Templates<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_Y7wO"><use href="#theme-svg-external-link"></use></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/PaimaStudios/paima-engine/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_TdTm">Effectstream Github<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_Y7wO"><use href="#theme-svg-external-link"></use></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_PnPB"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Haw5"><div class="docItemContainer_OM9T"><article><div class="tocCollapsible_o4j2 theme-doc-toc-mobile tocMobile_PSvY"><button type="button" class="clean-btn tocCollapsibleButton_GQbL">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Paima L2 Contract</h1></header>
<p>The <code>PaimaL2Contract</code> is a specialized, gas-efficient smart contract that serves as the primary &quot;mailbox&quot; or data entry point for your Effectstream application. While Paima can monitor any contract, the <code>PaimaL2Contract</code> is optimized for submitting user actions and game moves directly to your state machine.</p>
<p>Its design is intentionally simple: its main job is to accept arbitrary data from a user, wrap it in an event, and securely log that event on the blockchain for the Effectstream to process.</p>
<div class="language-solidity codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-solidity codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// SPDX-License-Identifier: MIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pragma</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">solidity</span><span class="token plain"> </span><span class="token operator">^</span><span class="token version number">0.8.20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;@openzeppelin/contracts/utils/Address.sol&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">/// @dev The main L2 contract for a Paima L2.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">contract</span><span class="token plain"> </span><span class="token class-name">PaimaL2Contract</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// ... (events and state variables)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">/// @dev Emits the `PaimaGameInteraction` event, logging the `msg.sender`, `data`, and `msg.value`.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">/// Revert if `msg.value` is less than set `fee`.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">paimaSubmitGameInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">calldata</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">payable</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value </span><span class="token operator">&gt;=</span><span class="token plain"> fee</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Sufficient funds required to submit game input&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">emit</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">PaimaGameInteraction</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// ... (owner-only administrative functions)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="core-functionality">Core Functionality<a href="#core-functionality" class="hash-link" aria-label="Direct link to Core Functionality" title="Direct link to Core Functionality">â€‹</a></h3>
<p>The contract&#x27;s logic centers around a single function and a single event.</p>
<ul>
<li>
<p><strong><code>paimaSubmitGameInput(bytes calldata data)</code></strong>: This is the function your frontend will call. It accepts a single <code>bytes</code> argument, which allows you to send any kind of data, but it&#x27;s designed to carry a concise grammar formatted according to your application&#x27;s <a href="/docs/home/components/grammar">Grammar</a> (e.g., <code>[&quot;attack&quot;,&quot;player1&quot;,&quot;monster7&quot;]</code>).</p>
</li>
<li>
<p><strong><code>PaimaGameInteraction</code> Event</strong>: When <code>paimaSubmitGameInput</code> is called, the contract does not perform any complex logic. It simply emits the <code>PaimaGameInteraction</code> event, logging three crucial pieces of information onto the blockchain:</p>
<ul>
<li><code>userAddress</code>: The wallet address of the user who called the function (<code>msg.sender</code>).</li>
<li><code>data</code>: The raw <code>bytes</code> payload that was submitted.</li>
<li><code>value</code>: The amount of cryptocurrency sent with the transaction (<code>msg.value</code>), used for the optional fee.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="how-it-connects-to-the-grammar-and-state-machine">How it Connects to the Grammar and State Machine<a href="#how-it-connects-to-the-grammar-and-state-machine" class="hash-link" aria-label="Direct link to How it Connects to the Grammar and State Machine" title="Direct link to How it Connects to the Grammar and State Machine">â€‹</a></h3>
<p>The <code>PaimaL2Contract</code> is the critical on-chain starting point that triggers your off-chain logic. The connection happens through a precise sequence of steps orchestrated by the Effectstream:</p>
<ol>
<li><strong>User Action</strong>: A user on your frontend initiates an action, which calls <code>paimaSubmitGameInput</code> on the deployed <code>PaimaL2Contract</code> with a formatted string (e.g., <code>[&quot;attack&quot;,&quot;player1&quot;,&quot;monster7&quot;]</code>).</li>
<li><strong>Event Emission</strong>: The contract executes and emits the <code>PaimaGameInteraction</code> event onto the blockchain.</li>
<li><strong>Sync Service Detection</strong>: The Effectstream&#x27;s <strong>Sync Service</strong>, which is constantly monitoring the blockchain, has a <strong>Primitive</strong> configured to listen specifically for the <code>PaimaGameInteraction</code> event from your contract&#x27;s address.</li>
<li><strong>Grammar Parsing</strong>: When the Sync Service detects a new event, it takes the <code>data</code> payload and passes it to the <strong>Grammar Parser</strong>. The parser checks the prefix (<code>[&quot;attack&quot;,...</code>) to identify which rule to apply. It then validates and parses the rest of the string into a structured, type-safe object.</li>
<li><strong>STF Execution</strong>: The engine uses the parsed prefix to identify and execute the corresponding <strong>State Transition Function (STF)</strong> in your state machine (e.g., the function registered for <code>&quot;attack&quot;</code>). The parsed data object is passed as an argument to your STF, where your game logic runs.</li>
</ol>
<p>This flow creates a secure and deterministic bridge from an on-chain event to your application&#x27;s state.</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="ownership-and-monetization">Ownership and Monetization<a href="#ownership-and-monetization" class="hash-link" aria-label="Direct link to Ownership and Monetization" title="Direct link to Ownership and Monetization">â€‹</a></h3>
<p>The <code>PaimaL2Contract</code> also includes administrative functions that allow the contract owner to manage it and optionally generate revenue.</p>
<ul>
<li><strong><code>setOwner(address newOwner)</code></strong>: Transfers ownership of the contract to a new address.</li>
<li><strong><code>setFee(uint256 newFee)</code></strong>: Sets a fee (in wei) that users must pay to call <code>paimaSubmitGameInput</code>. This is a simple way to monetize your dApp, as every action can contribute to a fee pool.</li>
<li><strong><code>withdrawFunds()</code></strong>: Allows the owner to withdraw the accumulated fees from the contract.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="built-in-grammar-commands-">Built-in Grammar Commands (<code>&amp;</code>)<a href="#built-in-grammar-commands-" class="hash-link" aria-label="Direct link to built-in-grammar-commands-" title="Direct link to built-in-grammar-commands-">â€‹</a></h3>
<blockquote>
<p>These are low level internal commands.
Normally you will not be directly using these mechanisms.</p>
</blockquote>
<p>While most of your application&#x27;s grammar is custom-defined to handle your specific game logic, Effectstream reserves a special prefix, <code>&amp;</code>, for a set of powerful, built-in system commands. These commands provide core functionalities common to most decentralized applications, including input batching and a flexible account management system.</p>
<p>These commands are processed directly by the Effectstream before your custom State Transition Functions (STFs) are run.</p>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="batched-inputs-b">Batched Inputs: <code>&amp;B</code><a href="#batched-inputs-b" class="hash-link" aria-label="Direct link to batched-inputs-b" title="Direct link to batched-inputs-b">â€‹</a></h4>
<p>Submitting one on-chain transaction for every single user action can be slow and expensive, leading to a poor user experience. To solve this, Paima provides a batching mechanism, primarily used by the <a href="/docs/home/components/batcher/overview">Batcher service</a>.</p>
<p>The <code>&amp;B</code> command allows multiple individual user inputs to be bundled together and submitted in a single on-chain transaction, significantly reducing costs and improving throughput.</p>
<p><strong>Grammar:</strong></p>
<div class="language-text codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-text codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[&quot;&amp;B&quot;,&quot;[input1,input2,input3,...]]</span><br></span></code></pre></div></div>
<ul>
<li><strong><code>input</code></strong>: A JSON-formatted array of strings. Each string in the array is a complete, individual user input (e.g., <code>&quot;[&quot;attack&quot;,&quot;p1&quot;,&quot;m7&quot;]</code>) that will be processed sequentially by the engine.</li>
</ul>
<p><strong>Example Payload:</strong></p>
<div class="language-json codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-json codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&amp;B&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;[\&quot;signature\&quot;, \&quot;wallet\&quot;, \&quot;attack\&quot;,\&quot;p1\&quot;,\&quot;m7\&quot;]&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;[\&quot;signature\&quot;, \&quot;wallet\&quot;, \&quot;use_item\&quot;,\&quot;p1\&quot;,\&quot;potion\&quot;]&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;[\&quot;signature\&quot;, \&quot;wallet\&quot;, \&quot;move\&quot;,\&quot;p1\&quot;,\&quot;c3\&quot;]&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre></div></div>
<p>A key feature of this system is its robustness &amp; security features. Each input within the batch is a string. If one of the inputs is malformed or invalid according to your grammar, the Effectstream will simply skip that single input and continue processing the rest of the batch. This prevents a single bad actor or a frontend bug from causing an entire batch of valid transactions to fail.</p>
<p>Typically, you will not construct this <code>&amp;B</code> string manually. The Batcher service and the Paima frontend SDKs handle the creation and submission of batched inputs automatically.</p>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="account-management-commands">Account Management Commands<a href="#account-management-commands" class="hash-link" aria-label="Direct link to Account Management Commands" title="Direct link to Account Management Commands">â€‹</a></h4>
<p>Effectstream includes a flexible, L2-native account system that goes beyond simple wallet addresses. A single &quot;Paima Account&quot; can be controlled by multiple wallets (e.g., a hot wallet on a mobile device and a hardware wallet for security), and the primary controlling wallet can be changed. This provides a form of L2 Account Abstraction.</p>
<p>These commands allow users to manage their Paima Account directly through the <code>PaimaL2Contract</code>.</p>
<ul>
<li>
<p><strong><code>&amp;createAccount</code></strong></p>
<ul>
<li><strong>Description</strong>: Creates a new, empty Paima Account. The wallet that sends this transaction (<code>msg.sender</code>) automatically becomes the first and primary address for this new account.</li>
</ul>
</li>
<li>
<p><strong><code>&amp;linkAddress</code></strong></p>
<ul>
<li><strong>Description</strong>: Links a new wallet address to an existing Paima Account. This process is secured by requiring signatures from both the current primary wallet (proving control over the account) and the new wallet being linked (proving its ownership).</li>
</ul>
</li>
<li>
<p><strong><code>&amp;unlinkAddress</code></strong></p>
<ul>
<li><strong>Description</strong>: Removes a wallet address from a Paima Account. This can be initiated either by the user themselves to leave an account, or by the primary wallet holder to remove another linked address.</li>
</ul>
</li>
</ul>
<p>More in <a href="/docs/home/components/accounts">accounts</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/PaimaStudios/paima-engine-docs/tree/main/docs/home/100-components/104-l2-contract.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_uRRq" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_xDOh"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/home/components/api"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">API</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/home/components/contracts"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Contracts</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Fe6u thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#core-functionality" class="table-of-contents__link toc-highlight">Core Functionality</a></li><li><a href="#how-it-connects-to-the-grammar-and-state-machine" class="table-of-contents__link toc-highlight">How it Connects to the Grammar and State Machine</a></li><li><a href="#ownership-and-monetization" class="table-of-contents__link toc-highlight">Ownership and Monetization</a></li><li><a href="#built-in-grammar-commands-" class="table-of-contents__link toc-highlight">Built-in Grammar Commands (<code>&amp;</code>)</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Midnight Foundation. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>