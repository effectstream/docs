"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5797],{1786:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"home/chains/evm","title":"EVM-Compatible Chains","description":"EVM (Ethereum Virtual Machine) chains serve as the primary layer for asset management and user interactions in many Effectstream dApps. Effectstream supports reading from RPC nodes and writing via standard or custom adapters.","source":"@site/docs/home/200-chains/201-evm.md","sourceDirName":"home/200-chains","slug":"/home/chains/evm","permalink":"/docs/ja/home/chains/evm","draft":false,"unlisted":false,"editUrl":"https://github.com/PaimaStudios/paima-engine-docs/tree/main/docs/home/200-chains/201-evm.md","tags":[],"version":"current","sidebarPosition":201,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Supported Chains","permalink":"/docs/ja/home/chains/"},"next":{"title":"Midnight","permalink":"/docs/ja/home/chains/midnight"}}');var i=t(2531),r=t(6613);const s={},o="EVM-Compatible Chains",c={},d=[{value:"1. Configuration (Read)",id:"1-configuration-read",level:2},{value:"Network Definition",id:"network-definition",level:3},{value:"Sync Protocol",id:"sync-protocol",level:3},{value:"Primitives",id:"primitives",level:3},{value:"2. Batcher Adapters (Write)",id:"2-batcher-adapters-write",level:2},{value:"Standard: Paima L2 Adapter",id:"standard-paima-l2-adapter",level:3},{value:"Custom: Smart Contract Interaction",id:"custom-smart-contract-interaction",level:3},{value:"3. Orchestration",id:"3-orchestration",level:2}];function l(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"evm-compatible-chains",children:"EVM-Compatible Chains"})}),"\n",(0,i.jsx)(n.p,{children:"EVM (Ethereum Virtual Machine) chains serve as the primary layer for asset management and user interactions in many Effectstream dApps. Effectstream supports reading from RPC nodes and writing via standard or custom adapters."}),"\n",(0,i.jsx)(n.h2,{id:"1-configuration-read",children:"1. Configuration (Read)"}),"\n",(0,i.jsxs)(n.p,{children:["To read data from an EVM chain, you must configure the Network, the Sync Protocol, and the Primitives in your ",(0,i.jsx)(n.code,{children:"localhostConfig.ts"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"network-definition",children:"Network Definition"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"addViemNetwork"})," to easily import chain definitions from ",(0,i.jsx)(n.code,{children:"viem/chains"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'.buildNetworks(builder =>\n  builder.addViemNetwork({\n    ...hardhat, // or arbitrum, mainnet, polygon, etc.\n    name: "evmMain",\n  })\n)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"sync-protocol",children:"Sync Protocol"}),"\n",(0,i.jsxs)(n.p,{children:["The protocol type is ",(0,i.jsx)(n.code,{children:"EVM_RPC_PARALLEL"}),". This connects to a JSON-RPC endpoint."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'.addParallel(\n  (networks) => networks.evmMain,\n  (network, deployments) => ({\n    name: "mainEvmRPC",\n    type: ConfigSyncProtocolType.EVM_RPC_PARALLEL,\n    chainUri: network.rpcUrls.default.http[0],\n    startBlockHeight: 1,\n    pollingInterval: 1000, // Polling frequency in ms\n    confirmationDepth: 1,  // Number of blocks to wait for finality\n  }),\n)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"primitives",children:"Primitives"}),"\n",(0,i.jsx)(n.p,{children:"Primitives define what events to listen for. Effectstream provides built-in primitives for common standards."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"PrimitiveTypeEVMPaimaL2"})}),": Listens for the ",(0,i.jsx)(n.code,{children:"PaimaGameInteraction"})," event on the ",(0,i.jsx)(n.code,{children:"PaimaL2Contract"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"PrimitiveTypeEVMERC20"})}),": Tracks ",(0,i.jsx)(n.code,{children:"Transfer"})," events and maintains a dynamic table of token balances."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"PrimitiveTypeEVMERC721"})}),": Tracks NFT ",(0,i.jsx)(n.code,{children:"Transfer"})," events and maintains ownership tables."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"PrimitiveTypeEVMERC1155"})}),": Tracks ",(0,i.jsx)(n.code,{children:"TransferSingle"})," and ",(0,i.jsx)(n.code,{children:"TransferBatch"})," events."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"NOTE: A generic primitive example is available in the source code."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { PrimitiveTypeEVMERC20 } from "@effectstream/sm/builtin";\n\n.addPrimitive(\n  (syncProtocols) => syncProtocols.mainEvmRPC,\n  (network, deployments, syncProtocol) => ({\n    name: "MyToken",\n    type: PrimitiveTypeEVMERC20,\n    startBlockHeight: 0,\n    contractAddress: "0x...", \n    stateMachinePrefix: "erc20-transfer", // Triggers STF\n  })\n)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"2-batcher-adapters-write",children:"2. Batcher Adapters (Write)"}),"\n",(0,i.jsxs)(n.p,{children:["To write data to an EVM chain (e.g., submit game moves or mint tokens), you configure the ",(0,i.jsx)(n.strong,{children:"Batcher"})," with an Adapter."]}),"\n",(0,i.jsx)(n.h3,{id:"standard-paima-l2-adapter",children:"Standard: Paima L2 Adapter"}),"\n",(0,i.jsxs)(n.p,{children:["If you are using the ",(0,i.jsx)(n.code,{children:"PaimaL2Contract"})," to submit generic game inputs, use the built-in ",(0,i.jsx)(n.code,{children:"PaimaL2DefaultAdapter"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { PaimaL2DefaultAdapter } from "@effectstream/batcher";\n\nconst evmAdapter = new PaimaL2DefaultAdapter(\n  contractAddress,\n  privateKey,\n  fee,\n  "mainEvmRPC" // Matches your Sync Protocol name\n);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"custom-smart-contract-interaction",children:"Custom: Smart Contract Interaction"}),"\n",(0,i.jsxs)(n.p,{children:["If you need to call specific functions with specific logic e.g., ",(0,i.jsx)(n.code,{children:"mint"}),", ",(0,i.jsx)(n.code,{children:"swap"}),", ",(0,i.jsx)(n.code,{children:"bridge"})," only if the user has enough assets in their wallet, you can implement a custom ",(0,i.jsx)(n.code,{children:"BlockchainAdapter"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example:"})," A custom adapter that calls a ",(0,i.jsx)(n.code,{children:"transferToMidnight"})," function on an ERC1155 contract (from the ",(0,i.jsx)(n.code,{children:"multi-chain-token-swap"})," template)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'export class ERC1155CustomAdapter implements BlockchainAdapter<string | null> {\n  // ... setup walletClient using viem ...\n\n  async submitBatch(data: string) {\n    // Parse the input data to determine arguments\n    const { args } = this.parseFunctionCall(data);\n    \n    // Write to the contract using viem\n    const hash = await this.walletClient.writeContract({\n        address: this.erc1155Address,\n        abi: mct_erc1155.abi,\n        functionName: "transferToMidnight",\n        args: args,\n    });\n    return hash;\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"3-orchestration",children:"3. Orchestration"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"launchEvm"})," from ",(0,i.jsx)(n.code,{children:"@effectstream/orchestrator/start-evm"})," to spin up a local Hardhat node and deploy contracts automatically."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'// in start.ts\nprocessesToLaunch: [\n  ...launchEvm("@my-project/evm-contracts"),\n]\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["NOTE: To use this launcher you need to implement some ",(0,i.jsx)(n.code,{children:"deno task"})," in your project. A working implementation is provided in the ",(0,i.jsx)(n.code,{children:"template generator"}),", ",(0,i.jsx)(n.code,{children:"templates"})," or ",(0,i.jsx)(n.code,{children:"e2e tests"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "name": "@chess/evm-contracts",\n  ...\n  "tasks": {\n    "swap:remappings:forge": "deno -A @paimaexample/evm-hardhat/remappings-forge --depth 4 --package @paimaexample",\n    "swap:remappings:hardhat": "deno -A @paimaexample/evm-hardhat/remappings-hardhat",\n    "check": "echo \'check\'",\n    "build:mod": {\n      // deploy:standalone does not return \'success\', as the hardhat process is terminated by chain:stop - so it cannot be invoked as dependency\n      "command": "(deno task deploy:standalone || true) && deno run -A @paimaexample/evm-hardhat/builder"\n    },\n    "build:clean": "rm -rf build || true",\n    "build:forge": {\n      "command": "forge build",\n      "dependencies": [\n        "swap:remappings:forge"\n      ]\n    },\n    "build:hardhat": {\n      "command": "deno run -A npm:hardhat@3.0.4 compile",\n      "dependencies": [\n        "swap:remappings:hardhat"\n      ]\n    },\n    "build": {\n      "command": "deno task build:forge && deno task build:hardhat",\n      "dependencies": [\n        "build:clean"\n      ]\n    },\n    "contract:compile": "deno task build:mod",\n    "deploy:clean": "rm -rf ignition/deployments || true",\n    "deploy:standalone": {\n      "command": "(((deno task chain:start) &) && (deno task chain:wait) && (deno task deploy) && deno task chain:stop) || true",\n      "dependencies": [\n        "build"\n      ]\n    },\n    "deploy": {\n      "command": "deno run -A deploy.ts",\n      "dependencies": [\n        "deploy:clean"\n      ]\n    },\n    "chain:start": "deno run -A npm:hardhat@3.0.4 node",\n    "chain:stop": "kill -9 $(lsof -ti tcp:8545) || true",\n    "chain:wait": "deno run -A npm:hardhat@3.0.4 node wait"\n  }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},6613:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var a=t(1491);const i={},r=a.createContext(i);function s(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);