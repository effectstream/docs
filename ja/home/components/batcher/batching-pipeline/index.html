<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-home/components/batcher/batching-pipeline" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">The Batching Pipeline | Effectstream</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://effectstream.github.io/docs/ja/img/no-image.png"><meta data-rh="true" name="twitter:image" content="https://effectstream.github.io/docs/ja/img/no-image.png"><meta data-rh="true" property="og:url" content="https://effectstream.github.io/docs/ja/home/components/batcher/batching-pipeline"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="The Batching Pipeline | Effectstream"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/docs/ja/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://effectstream.github.io/docs/ja/home/components/batcher/batching-pipeline"><link data-rh="true" rel="alternate" href="https://effectstream.github.io/docs/home/components/batcher/batching-pipeline" hreflang="en"><link data-rh="true" rel="alternate" href="https://effectstream.github.io/docs/ja/home/components/batcher/batching-pipeline" hreflang="ja"><link data-rh="true" rel="alternate" href="https://effectstream.github.io/docs/home/components/batcher/batching-pipeline" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><link rel="stylesheet" href="/docs/ja/assets/css/styles.3561bdc5.css">
<script src="/docs/ja/assets/js/runtime~main.ff192aec.js" defer="defer"></script>
<script src="/docs/ja/assets/js/main.23e4697d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/ja/img/favicon.ico"><div role="region" aria-label="„É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Åæ„Åß„Çπ„Ç≠„ÉÉ„Éó"><a class="skipToContent_LRwd" href="#__docusaurus_skipToContent_fallback">„É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Åæ„Åß„Çπ„Ç≠„ÉÉ„Éó</a></div><div class="theme-announcement-bar announcementBar_llC7" style="background-color:#fffcf9;color:#ef476f" role="banner"><div class="content_Pagn announcementBarContent_QHqT">
      <div class="custom-banner">
        <p><strong>You are looking at Effectstream v2 docs</strong></p>
        <p>Effectstream v2 is still under constructionüöß</p>
      </div>
    </div></div><nav aria-label="„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éê„Éº„ÇíÈñã„Åè" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/docs/ja/"><div class="navbar__logo"><img src="/docs/ja/img/favicon.ico" alt="Effectstream logo" class="themedComponent_m_92 themedComponent--light_mRW5"><img src="/docs/ja/img/favicon.ico" alt="Effectstream logo" class="themedComponent_m_92 themedComponent--dark_iQ27"></div><b class="navbar__title text--truncate">Effectstream</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_J6rI"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Japanese</a><ul class="dropdown__menu"><li><a href="/docs/home/components/batcher/batching-pipeline" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/docs/ja/home/components/batcher/batching-pipeline" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ja">Japanese</a></li></ul></div><div class="navbarSearchContainer_E3Re"><div class="navbar__search searchBarContainer_sERs" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_s8y1 searchBarLoadingRing_W2S3"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_Gcnp"><div class="docsWrapper_xhHm"><button aria-label="ÂÖàÈ†≠„Å∏Êàª„Çã" class="clean-btn theme-back-to-top-button backToTopButton_P6dF" type="button"></button><div class="docRoot_QZFe"><aside class="theme-doc-sidebar-container docSidebarContainer_z8Xi"><div class="sidebarViewport_LtND"><div class="sidebar_eBd7"><nav aria-label="„Éâ„Ç≠„É•„É°„É≥„Éà„ÅÆ„Çµ„Ç§„Éâ„Éê„Éº" class="menu thin-scrollbar menu_sQgX menuWithAnnouncementBar_IFIy"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/ja/">Intro</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/what-is-effectstream">What is Effectstream?</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/ja/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/ja/home/components/">Components</a><button aria-label="&#x27;Components&#x27;„ÅÆÁõÆÊ¨°„ÇíÈö†„Åô" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/sync-service">Sync Protocols &amp; Chain Config</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/state-machine">State Machine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/api">API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/effectstream-l2-contract">Paima L2 Contract</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/contracts">Contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/processes">Process Orchestrator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/explorer">Paima Explorer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/ja/home/components/batcher/overview">Batcher</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/batcher/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/batcher/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/batcher/core-concepts">Core Concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/ja/home/components/batcher/batching-pipeline">The Batching Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/batcher/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/batcher/adapter">Custom Adapters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/batcher/advanced-topics">Advanced Topics</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/database">Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/logs">Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/grammar">Grammar</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/wallets">Wallets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/randomness">Randomness</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/achievements">Achievements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/frontend">Frontend (dApp)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/accounts">Accounts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/node-startup">Node Startup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ja/home/components/primitives">Primitives</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/ja/home/chains/">Chains</a><button aria-label="&#x27;Chains&#x27;„ÅÆÁõÆÊ¨°„ÇíÈñã„Åè" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/ja/home/deployment/deploy-game">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/ja/home/effectstream-standards/paima-standards">Paima Standards (PRCs)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/ja/home/effectstream-engine/">Architecture</a><button aria-label="&#x27;Architecture&#x27;„ÅÆÁõÆÊ¨°„ÇíÈñã„Åè" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/ja/home/templates/evm-midnight">Templates</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/PaimaStudios/paima-game-templates" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_TdTm">Paima Game Templates<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_Y7wO"><use href="#theme-svg-external-link"></use></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/PaimaStudios/paima-engine/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_TdTm">Effectstream Github<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_Y7wO"><use href="#theme-svg-external-link"></use></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_PnPB"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Haw5"><div class="docItemContainer_OM9T"><article><div class="tocCollapsible_o4j2 theme-doc-toc-mobile tocMobile_PSvY"><button type="button" class="clean-btn tocCollapsibleButton_GQbL">„Åì„ÅÆ„Éö„Éº„Ç∏„ÅÆË¶ãÂá∫„Åó</button></div><div class="theme-doc-markdown markdown"><header><h1>The Batching Pipeline</h1></header>
<h2 class="anchor anchorWithStickyNavbar_qIhk" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Overview „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Overview „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h2>
<p>Understanding how an input flows through the Batcher system is essential for effective integration and customization. This document provides a comprehensive, step-by-step overview of an input&#x27;s lifecycle‚Äîfrom the initial API call to final chain confirmation.</p>
<p>This knowledge helps you:</p>
<ul>
<li>Understand where adapter customization hooks in</li>
<li>Configure appropriate confirmation levels for your use case</li>
<li>Debug issues in the batching flow</li>
<li>Optimize batch submission timing</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_qIhk" id="target-audience">Target Audience<a href="#target-audience" class="hash-link" aria-label="Target Audience „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Target Audience „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h2>
<p>Developers building on or integrating with the Paima platform who need to batch transactions, especially those who want to:</p>
<ul>
<li>Customize adapter behavior for different blockchains</li>
<li>Understand validation and security guarantees</li>
<li>Configure confirmation levels appropriately</li>
<li>Implement custom batching strategies</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_qIhk" id="the-input-lifecycle">The Input Lifecycle<a href="#the-input-lifecycle" class="hash-link" aria-label="The Input Lifecycle „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="The Input Lifecycle „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h2>
<p>Every input submitted to the Batcher goes through a well-defined pipeline. Here&#x27;s the complete journey:</p>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="step-1-ingestion">Step 1: Ingestion<a href="#step-1-ingestion" class="hash-link" aria-label="Step 1: Ingestion „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Step 1: Ingestion „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h3>
<p>An HTTP POST request is made to the <code>/send-input</code> endpoint with a payload conforming to the <code>DefaultBatcherInput</code> type:</p>
<div class="language-typescript codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-typescript codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string-property property">&quot;address&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string-property property">&quot;addressType&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// EVM address type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string-property property">&quot;input&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;myGameCommand|arg1|arg2&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string-property property">&quot;signature&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0x...&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string-property property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1234567890&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string-property property">&quot;target&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;evm&quot;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Optional, uses defaultTarget if not specified</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string-property property">&quot;confirmationLevel&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;wait-receipt&quot;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>The API accepts the request and begins processing it through the pipeline.</p>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="step-2-targeting">Step 2: Targeting<a href="#step-2-targeting" class="hash-link" aria-label="Step 2: Targeting „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Step 2: Targeting „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h3>
<p>The batcher examines the <code>input.target</code> field to determine which blockchain adapter should handle this input. If <code>target</code> is not provided, it falls back to the <code>defaultTarget</code> specified in the <code>PaimaBatcherConfig</code>.</p>
<p>For example, if your configuration has:</p>
<div class="language-typescript codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-typescript codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  adapters</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    evm</span><span class="token operator">:</span><span class="token plain"> evmAdapter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    midnight</span><span class="token operator">:</span><span class="token plain"> midnightAdapter </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  defaultTarget</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;evm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>Then an input without a <code>target</code> field will be routed to the <code>evmAdapter</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="step-3-validation-adapter-driven">Step 3: Validation (Adapter-Driven)<a href="#step-3-validation-adapter-driven" class="hash-link" aria-label="Step 3: Validation (Adapter-Driven) „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Step 3: Validation (Adapter-Driven) „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h3>
<p>Once the target adapter is identified, the batcher performs two crucial validation steps <strong>before</strong> the input is queued:</p>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="3a-signature-verification">3a. Signature Verification<a href="#3a-signature-verification" class="hash-link" aria-label="3a. Signature Verification „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="3a. Signature Verification „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h4>
<p>The batcher calls the adapter&#x27;s <code>verifySignature()</code> method. This is adapter-specific because different blockchains have different signature schemes:</p>
<ul>
<li><strong>EVM adapters</strong>: Use the default EVM signature verification (via <code>CryptoManager.Evm().verifySignature()</code>)</li>
<li><strong>Custom adapters</strong>: Can override this method to implement their own logic or bypass it entirely</li>
</ul>
<div class="language-typescript codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-typescript codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">verifySignature</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> DefaultBatcherInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">boolean</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Bypass the default EVM signature check</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>If signature verification fails, the input is <strong>rejected immediately</strong> with a <code>401 Unauthorized</code> error.</p>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="3b-input-validation">3b. Input Validation<a href="#3b-input-validation" class="hash-link" aria-label="3b. Input Validation „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="3b. Input Validation „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h4>
<p>The adapter&#x27;s <code>validateInput()</code> method is called to perform semantic validation specific to that blockchain:</p>
<ul>
<li>Check circuit argument formats (e.g., for zero-knowledge chains)</li>
<li>Validate payload structure</li>
<li>Verify account formats</li>
<li>Check any other chain-specific requirements</li>
</ul>
<div class="language-typescript codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-typescript codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Example validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">validateInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> DefaultBatcherInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">:</span><span class="token plain"> ValidationResult </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token function" style="color:rgb(80, 250, 123)">isValidCircuitArgs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">input</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      valid</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      error</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Invalid circuit arguments format&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> valid</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>If validation fails, the input is <strong>rejected immediately</strong> with a <code>400 Bad Request</code> error containing the validation error message.</p>
<div class="theme-admonition theme-admonition-tip admonition_kxwc alert alert--success"><div class="admonitionHeading_ib1B"><span class="admonitionIcon_s7m2"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Why Validate Before Queuing?</div><div class="admonitionContent_e9z6"><p>Pre-queue validation ensures that only valid inputs reach persistent storage. This prevents storage pollution and makes the system more robust during restarts and crashes.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="step-4-queuing">Step 4: Queuing<a href="#step-4-queuing" class="hash-link" aria-label="Step 4: Queuing „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Step 4: Queuing „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h3>
<p>After passing validation, the input is saved to the <code>BatcherStorage</code> (e.g., <code>FileStorage</code>, PostgreSQL, Redis).</p>
<p><strong>Important</strong>: Storage is the single source of truth. There are no in-memory queues that could be lost on restart.</p>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="confirmation-level-no-wait">Confirmation Level: &quot;no-wait&quot;<a href="#confirmation-level-no-wait" class="hash-link" aria-label="Confirmation Level: &quot;no-wait&quot; „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Confirmation Level: &quot;no-wait&quot; „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h4>
<p>If <code>confirmationLevel</code> is set to <code>&quot;no-wait&quot;</code>, the API call <strong>returns immediately</strong> at this point with a success response:</p>
<div class="language-json codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-json codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;success&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;message&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Input queued for batching&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;inputsProcessed&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>The caller doesn&#x27;t wait for the batch to be submitted or confirmed.</p>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="step-5-polling--criteria-check">Step 5: Polling &amp; Criteria Check<a href="#step-5-polling--criteria-check" class="hash-link" aria-label="Step 5: Polling &amp; Criteria Check „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Step 5: Polling &amp; Criteria Check „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h3>
<p>The main <code>PaimaBatcher</code> loop runs at intervals defined by <code>pollingIntervalMs</code> (e.g., every 1000ms). On each iteration:</p>
<ol>
<li>For each adapter target (e.g., &quot;evm&quot;, &quot;midnight&quot;), the batcher checks the batching criteria</li>
<li>The criteria determine if enough inputs have accumulated or enough time has passed</li>
<li>Different targets can have different criteria</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="batching-criteria-types">Batching Criteria Types<a href="#batching-criteria-types" class="hash-link" aria-label="Batching Criteria Types „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Batching Criteria Types „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h4>
<table><thead><tr><th>Criteria Type</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><strong>time</strong></td><td>Submit every N milliseconds</td><td><code>{ criteriaType: &quot;time&quot;, timeWindowMs: 5000 }</code></td></tr><tr><td><strong>size</strong></td><td>Submit when N inputs accumulate</td><td><code>{ criteriaType: &quot;size&quot;, maxBatchSize: 10 }</code></td></tr><tr><td><strong>value</strong></td><td>Submit when accumulated value reaches threshold</td><td><code>{ criteriaType: &quot;value&quot;, targetValue: 100 }</code></td></tr><tr><td><strong>hybrid</strong></td><td>Submit when time OR size criteria met</td><td><code>{ criteriaType: &quot;hybrid&quot;, timeWindowMs: 5000, maxBatchSize: 10 }</code></td></tr><tr><td><strong>custom</strong></td><td>Custom function determines readiness</td><td><code>{ criteriaType: &quot;custom&quot;, isBatchReadyFn: (inputs) =&gt; {...} }</code></td></tr></tbody></table>
<p>Example configuration:</p>
<div class="language-typescript codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-typescript codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token plain">batchingCriteria</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  evm</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    criteriaType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;time&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    timeWindowMs</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">5000</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  midnight</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    criteriaType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;hybrid&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    timeWindowMs</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    maxBatchSize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>When the criteria for a target is satisfied, the batcher proceeds to build and submit the batch.</p>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="step-6-building-adapter-driven">Step 6: Building (Adapter-Driven)<a href="#step-6-building-adapter-driven" class="hash-link" aria-label="Step 6: Building (Adapter-Driven) „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Step 6: Building (Adapter-Driven) „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h3>
<p>Once a target is ready for batching, the batcher:</p>
<ol>
<li>Retrieves pending inputs for that target from storage</li>
<li>Calls the adapter&#x27;s <code>buildBatchData()</code> method with these inputs</li>
</ol>
<p>The adapter&#x27;s <code>buildBatchData()</code> method is responsible for:</p>
<ul>
<li>Serializing inputs into a blockchain-specific format</li>
<li>Handling size constraints (respecting <code>maxBatchSize</code>)</li>
<li>Deciding which inputs to include or exclude</li>
<li>Returning the final batch payload</li>
</ul>
<div class="language-typescript codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-typescript codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name">BatchBuildingResult</span><span class="token class-name operator">&lt;</span><span class="token class-name">TOutput</span><span class="token class-name operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  selectedInputs</span><span class="token operator">:</span><span class="token plain"> DefaultBatcherInput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Inputs included in this batch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  data</span><span class="token operator">:</span><span class="token plain"> TOutput</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Serialized batch data (format depends on chain)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>For example:</p>
<ul>
<li><strong>EVM adapters</strong> might serialize to a hex string</li>
<li><strong>Midnight adapters</strong> might construct circuit arguments</li>
<li><strong>Custom adapters</strong> can use any format their chain accepts</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="step-7-submission-adapter-driven">Step 7: Submission (Adapter-Driven)<a href="#step-7-submission-adapter-driven" class="hash-link" aria-label="Step 7: Submission (Adapter-Driven) „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Step 7: Submission (Adapter-Driven) „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h3>
<p>The batcher calls the adapter&#x27;s <code>submitBatch()</code> method, passing:</p>
<ul>
<li>The serialized data from Step 6</li>
<li>An estimated fee (obtained via <code>estimateBatchFee()</code>)</li>
</ul>
<div class="language-typescript codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-typescript codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> fee </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> adapter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">estimateBatchFee</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> txHash </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> adapter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">submitBatch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> fee</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>The adapter handles all blockchain-specific submission logic:</p>
<ul>
<li>Constructing the transaction</li>
<li>Signing it with the configured private key</li>
<li>Submitting it to the RPC endpoint</li>
<li>Returning the transaction hash</li>
</ul>
<p>State transition event <code>batch:submit</code> is emitted at this point.</p>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="step-8-confirmation-adapter-driven">Step 8: Confirmation (Adapter-Driven)<a href="#step-8-confirmation-adapter-driven" class="hash-link" aria-label="Step 8: Confirmation (Adapter-Driven) „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Step 8: Confirmation (Adapter-Driven) „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h3>
<p>After submission, the batcher calls <code>adapter.waitForTransactionReceipt()</code> to wait for the transaction to be included in a block.</p>
<p>The adapter polls the blockchain until:</p>
<ul>
<li>The transaction is confirmed (successful receipt)</li>
<li>An error occurs</li>
<li>A timeout is reached</li>
</ul>
<p>Once the receipt is obtained:</p>
<ul>
<li>The processed inputs are <strong>removed from storage</strong></li>
<li>State transition event <code>batch:receipt</code> is emitted</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="confirmation-level-wait-receipt">Confirmation Level: &quot;wait-receipt&quot;<a href="#confirmation-level-wait-receipt" class="hash-link" aria-label="Confirmation Level: &quot;wait-receipt&quot; „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Confirmation Level: &quot;wait-receipt&quot; „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h4>
<p>If <code>confirmationLevel</code> is <code>&quot;wait-receipt&quot;</code>, the API call <strong>returns at this point</strong>:</p>
<div class="language-json codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-json codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;success&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;message&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Input processed successfully&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;transactionHash&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0xabc...&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;inputsProcessed&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="step-9-effectstream-processing-optional">Step 9: Effectstream Processing (Optional)<a href="#step-9-effectstream-processing-optional" class="hash-link" aria-label="Step 9: Effectstream Processing (Optional) „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Step 9: Effectstream Processing (Optional) „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h3>
<p>After blockchain confirmation, the batcher optionally waits for the Effectstream to process the batch. This step:</p>
<ol>
<li>Monitors Effectstream Sync events for the specific transaction</li>
<li>Waits until the Effectstream has parsed and validated the inputs</li>
<li>Returns the rollup block number where processing occurred</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_qIhk" id="confirmation-level-wait-effectstream-processed">Confirmation Level: &quot;wait-effectstream-processed&quot;<a href="#confirmation-level-wait-effectstream-processed" class="hash-link" aria-label="Confirmation Level: &quot;wait-effectstream-processed&quot; „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Confirmation Level: &quot;wait-effectstream-processed&quot; „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h4>
<p>If <code>confirmationLevel</code> is <code>&quot;wait-effectstream-processed&quot;</code>, the API call <strong>waits until this step completes</strong>:</p>
<div class="language-json codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-json codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;success&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;message&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Input processed and validated by Effectstream&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;transactionHash&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0xabc...&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;rollup&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">12345</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;inputsProcessed&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>This provides the strongest guarantee: the input has been confirmed on-chain <strong>and</strong> processed by your game/application logic.</p>
<h3 class="anchor anchorWithStickyNavbar_qIhk" id="step-10-callback-resolution">Step 10: Callback Resolution<a href="#step-10-callback-resolution" class="hash-link" aria-label="Step 10: Callback Resolution „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Step 10: Callback Resolution „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h3>
<p>Finally, the original API caller receives the response based on their configured <code>confirmationLevel</code>.</p>
<p>All waiting callers whose inputs were included in this batch are resolved simultaneously.</p>
<h2 class="anchor anchorWithStickyNavbar_qIhk" id="confirmation-level-fallback-logic">Confirmation Level Fallback Logic<a href="#confirmation-level-fallback-logic" class="hash-link" aria-label="Confirmation Level Fallback Logic „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Confirmation Level Fallback Logic „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h2>
<p>If <code>confirmationLevel</code> is not explicitly provided in the API call, the batcher uses this fallback hierarchy:</p>
<ol>
<li>
<p><strong>Target-specific configuration</strong>: Check if <code>PaimaBatcherConfig.confirmationLevel</code> is an object with a key matching the target:</p>
<div class="language-typescript codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-typescript codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token plain">confirmationLevel</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  evm</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;no-wait&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  midnight</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;wait-receipt&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Global configuration</strong>: If <code>confirmationLevel</code> is a string, use it for all targets:</p>
<div class="language-typescript codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-typescript codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token plain">confirmationLevel</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;wait-receipt&quot;</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Default</strong>: If nothing is configured, default to <code>&quot;wait-receipt&quot;</code></p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_qIhk" id="pipeline-visualization">Pipeline Visualization<a href="#pipeline-visualization" class="hash-link" aria-label="Pipeline Visualization „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Pipeline Visualization „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h2>
<div class="language-text codeBlockContainer_Epcf theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_zcFB"><pre tabindex="0" class="prism-code language-text codeBlock_JaaR thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_O7QW"><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  1. HTTP POST /send-input                                   ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚ñº</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  2. Target Selection (use input.target or defaultTarget)    ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚ñº</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  3. Validation (Adapter-Driven)                             ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ     ‚Ä¢ verifySignature() - Check cryptographic signature     ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ     ‚Ä¢ validateInput() - Semantic validation                 ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ                                                              ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  ‚ùå Fails ‚Üí 400/401 error returned immediately              ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚ñº</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  4. Save to BatcherStorage                                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ                                                              ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  üîπ confirmationLevel: &quot;no-wait&quot; ‚Üí API returns here         ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚ñº</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  5. Polling Loop (every pollingIntervalMs)                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ     Check batchingCriteria for each target                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ     Ready? ‚Üí Proceed to build                               ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚ñº</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  6. adapter.buildBatchData()                                ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ     Serialize inputs ‚Üí blockchain-specific format           ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚ñº</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  7. adapter.submitBatch(data, fee)                          ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ     Submit transaction to blockchain                        ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚ñº</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  8. adapter.waitForTransactionReceipt()                     ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ     Wait for blockchain confirmation                        ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ     Remove processed inputs from storage                    ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ                                                              ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  üîπ confirmationLevel: &quot;wait-receipt&quot; ‚Üí API returns here    ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚ñº</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  9. Wait for Paima Processing (Optional)                    ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ     Monitor Paima Sync events                               ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ     Wait for rollup block processing                        ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ                                                              ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  üîπ confirmationLevel: &quot;wait-effectstream-processed&quot; ‚Üí returns here‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                  ‚ñº</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ  10. Callback Resolution                                    ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îÇ      Return final response to API caller                    ‚îÇ</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_qIhk" id="key-takeaways">Key Takeaways<a href="#key-takeaways" class="hash-link" aria-label="Key Takeaways „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Key Takeaways „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h2>
<ol>
<li><strong>Validation happens before queuing</strong>: Invalid inputs never reach storage</li>
<li><strong>Storage is crash-safe</strong>: Inputs persist through restarts</li>
<li><strong>Adapters control key operations</strong>: Signature verification, validation, building, and submission are all adapter-specific</li>
<li><strong>Confirmation levels offer flexibility</strong>: Choose between immediate return, blockchain confirmation, or full Paima processing</li>
<li><strong>Per-target configuration</strong>: Different blockchain targets can have different criteria and confirmation levels</li>
<li><strong>Event-driven observability</strong>: State transitions emit events throughout the pipeline for monitoring and logging</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_qIhk" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Next Steps „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ" title="Next Steps „Å∏„ÅÆÁõ¥Êé•„É™„É≥„ÇØ">‚Äã</a></h2>
<ul>
<li>Learn about <a href="/docs/ja/home/components/batcher/adapter">Custom Adapters</a> to support new blockchains</li>
<li>Explore <a href="/docs/ja/home/components/batcher/advanced-topics#batching-criteria">Batching Criteria</a> for advanced batch timing strategies</li>
<li>Review <a href="/docs/ja/home/components/batcher/configuration">Configuration Reference</a> for all available options</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/PaimaStudios/paima-engine-docs/tree/main/docs/home/100-components/108-batcher/1230-batching-pipeline.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_uRRq" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>„Åì„ÅÆ„Éö„Éº„Ç∏„ÇíÁ∑®ÈõÜ</a></div><div class="col lastUpdated_xDOh"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="„Éâ„Ç≠„É•„É°„É≥„Éà„Éö„Éº„Ç∏"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/ja/home/components/batcher/core-concepts"><div class="pagination-nav__sublabel">Ââç„Å∏</div><div class="pagination-nav__label">Core Concepts</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/ja/home/components/batcher/configuration"><div class="pagination-nav__sublabel">Ê¨°„Å∏</div><div class="pagination-nav__label">Configuration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Fe6u thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#target-audience" class="table-of-contents__link toc-highlight">Target Audience</a></li><li><a href="#the-input-lifecycle" class="table-of-contents__link toc-highlight">The Input Lifecycle</a><ul><li><a href="#step-1-ingestion" class="table-of-contents__link toc-highlight">Step 1: Ingestion</a></li><li><a href="#step-2-targeting" class="table-of-contents__link toc-highlight">Step 2: Targeting</a></li><li><a href="#step-3-validation-adapter-driven" class="table-of-contents__link toc-highlight">Step 3: Validation (Adapter-Driven)</a></li><li><a href="#step-4-queuing" class="table-of-contents__link toc-highlight">Step 4: Queuing</a></li><li><a href="#step-5-polling--criteria-check" class="table-of-contents__link toc-highlight">Step 5: Polling &amp; Criteria Check</a></li><li><a href="#step-6-building-adapter-driven" class="table-of-contents__link toc-highlight">Step 6: Building (Adapter-Driven)</a></li><li><a href="#step-7-submission-adapter-driven" class="table-of-contents__link toc-highlight">Step 7: Submission (Adapter-Driven)</a></li><li><a href="#step-8-confirmation-adapter-driven" class="table-of-contents__link toc-highlight">Step 8: Confirmation (Adapter-Driven)</a></li><li><a href="#step-9-effectstream-processing-optional" class="table-of-contents__link toc-highlight">Step 9: Effectstream Processing (Optional)</a></li><li><a href="#step-10-callback-resolution" class="table-of-contents__link toc-highlight">Step 10: Callback Resolution</a></li></ul></li><li><a href="#confirmation-level-fallback-logic" class="table-of-contents__link toc-highlight">Confirmation Level Fallback Logic</a></li><li><a href="#pipeline-visualization" class="table-of-contents__link toc-highlight">Pipeline Visualization</a></li><li><a href="#key-takeaways" class="table-of-contents__link toc-highlight">Key Takeaways</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2025 Midnight Foundation. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>